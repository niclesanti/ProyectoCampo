<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campito - Dashboard</title>
    <meta name="description" content="Dashboard de gestión para Campito.">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" id="theme-color-meta" content="#3B82F6">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" href="/logo_login.png" type="image/png">
    <link rel="shortcut icon" href="/logo_login.png" type="image/png">
    <link rel="apple-touch-icon" href="/logo_login.png">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <!-- Menú Lateral (Off-canvas) -->
    <aside id="sideMenu" class="side-menu" hidden>
        <div id="sideMenuOverlay" class="side-menu__overlay"></div>
        <div class="side-menu__content">
            <div class="side-menu__header">
                <button id="closeSideMenuBtn" class="side-menu__close-btn" aria-label="Cerrar menú">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="side-menu__brand">
                <img src="/logo_login.png" alt="Logo CAMPITO" class="side-menu__logo-img">
                <span class="side-menu__title">Campito</span>
            </div>
            <nav class="side-menu__nav">
                <a href="#" class="side-menu__nav-link side-menu__nav-link--active">
                    <i class="fas fa-dollar-sign"></i>
                    <span>Finanzas</span>
                </a>
                <a href="#" class="side-menu__nav-link">
                    <i class="fas fa-tractor"></i>
                    <span>Producción</span>
                </a>
            </nav>
            <div class="side-menu__user-info">
                <div class="side-menu__user-details">
                    <span class="side-menu__username">Usuario Ejemplo</span>
                    <span class="side-menu__email">usuario@ejemplo.com</span>
                </div>
                <a href="/logout" class="side-menu__logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                </a>
            </div>
        </div>
    </aside>

    <!-- Encabezado Principal -->
    <header class="header">
        <div class="header__content">
            <div class="header__left-section">
                <button id="menuBtn" class="header__icon-btn" aria-label="Abrir menú">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            <div class="header__center-section">
                <img src="/logo.png" alt="Logo CAMPITO" class="header__logo-img">
            </div>
            <div class="header__right-section">
                <div class="header__notifications">
                    <button id="notificationsBtn" class="header__icon-btn" aria-label="Ver notificaciones">
                        <i class="fas fa-bell"></i>
                    </button>
                    <!-- Menú Desplegable de Notificaciones -->
                    <div id="notificationsMenu" class="notifications-menu" hidden>
                        <div class="notifications-menu__header">
                            <h3 class="notifications-menu__title">Notificaciones</h3>
                        </div>
                        <div class="notifications-menu__content">
                            <p class="notifications-menu__empty-message">Aún no tienes notificaciones.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Selector de Espacio de Trabajo -->
    <section class="workspace-selector">
        <div class="workspace-selector__container">
            <select id="workspaceSelect" class="workspace-selector__select">
                <option value="campo-nuevo">Seleccionar espacio de trabajo</option>
            </select>
            <button id="manageWorkspacesBtn" class="btn btn--secondary">
                <i class="fas fa-folder-open"></i> Espacios de trabajo
            </button>
        </div>
    </section>

    <main class="dashboard">
        <!-- Sección de Resumen de Saldos -->
        <section class="balance-section" aria-labelledby="balance-title">
            <div class="summary-grid">
                <!-- Ingresos del Mes -->
                <div class="card card--balance">
                    <h2 class="card__title">Ingresos del Mes</h2>
                    <div id="incomeAmount" class="balance__amount balance__amount--income">
                        <span class="balance__currency">$</span>
                        <span class="balance__value">0</span>
                    </div>
                    <p id="incomeMonth" class="balance__date">--</p>
                </div>
                <!-- Gastos del Mes -->
                <div class="card card--balance">
                    <h2 class="card__title">Gastos del Mes</h2>
                    <div id="expenseAmount" class="balance__amount balance__amount--expense">
                        <span class="balance__currency">$</span>
                        <span class="balance__value">0</span>
                    </div>
                    <p id="expenseMonth" class="balance__date">--</p>
                </div>
                <!-- Saldo Neto del Mes -->
                <div class="card card--balance">
                    <h2 class="card__title">Saldo Neto del Mes</h2>
                    <div id="netAmount" class="balance__amount">
                        <span class="balance__currency">$</span>
                        <span class="balance__value">0</span>
                    </div>
                    <p id="netMonth" class="balance__date">--</p>
                </div>
                <!-- Saldo Histórico -->
                <div class="card card--balance">
                    <h2 class="card__title">Saldo Histórico</h2>
                    <div id="historicalBalanceAmount" class="balance__amount">
                        <span class="balance__currency">$</span>
                        <span class="balance__value">0</span>
                    </div>
                    <p id="historicalBalanceDate" class="balance__date">Actualizando...</p>
                </div>
            </div>
        </section>

        <!-- Acciones Rápidas -->
        <section class="quick-actions" aria-label="Acciones rápidas">
            <button id="newTransactionBtn" class="btn btn--primary">
                <i class="fas fa-dollar-sign"></i>
                Movimientos de dinero
            </button>
            <button id="searchTransactionsBtn" class="btn btn--secondary">
                <i class="fas fa-search"></i>
                Ver movimientos
            </button>
            <button id="setupAlertsBtn" class="btn btn--secondary">
                <i class="fas fa-bell"></i>
                Alertas
            </button>
        </section>

        <!-- Gráficos -->
        <section class="charts-section" aria-label="Visualización de datos">
            <div class="card card--chart">
                <h3 class="card__title">Ingresos vs Gastos mensuales</h3>
                <canvas id="monthlyChart"></canvas>
            </div>
            <div class="card card--chart">
                <h3 class="card__title">Distribución de gastos</h3>
                <p class="card__subtitle">Últimos 6 meses</p>
                <canvas id="expensesChart"></canvas>
            </div>
            <div class="card card--chart">
                <h3 class="card__title">Tendencia del saldo acumulado</h3>
                <canvas id="balanceTrendChart"></canvas>
            </div>
        </section>

        <!-- Listados -->
        <section class="lists-section" aria-label="Listado de Cuentas y Transacciones">
            <!-- Cuentas Bancarias -->
            <div class="card card--accounts">
                <div class="card__header">
                    <h3 class="card__title">Cuentas bancarias</h3>
                </div>
                <div id="lista-cuentas-bancarias" class="accounts-list">
                    <!-- Las cuentas se cargarán aquí dinámicamente -->
                </div>
            </div>

            <!-- Movimientos Recientes -->
            <div class="card card--transactions-list">
                <div class="card__header">
                    <h3 id="transactions-title" class="card__title">Movimientos recientes</h3>
                    <button id="viewAllTransactionsBtn" class="btn btn--text">
                        Ver todos
                    </button>
                </div>
                <div id="recentTransactionsList" class="transactions-list">
                    <!-- Las transacciones se cargarán aquí dinámicamente -->
                </div>
            </div>
        </section>
    </main>

    <!-- Modal: Movimientos de dinero -->
    <div id="transactionModal" class="modal" hidden>
        <div class="modal__content">
            <div class="modal__header">
                <h2 class="modal__title">Movimientos de dinero</h2>
                <button id="closeTransactionModalBtn" class="modal__close-btn" aria-label="Cerrar modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal__body">
                <div class="tabs">
                    <button class="tabs__button tabs__button--active" data-tab="gasto-ingreso">Gastos/Ingresos</button>
                    <button class="tabs__button" data-tab="transferencia">Movimientos entre cuentas</button>
                </div>

                <!-- Contenido de Gasto/Ingreso -->
                <div id="tab-gasto-ingreso" class="tab-content tab-content--active">
                    <form id="transactionForm" class="form">
                        <p class="form__subtitle">Anotar un nueva salida o ingreso de dinero con todos sus detalles.</p>
                        <div class="form__group">
                            <label for="transactionType" class="form__label">Tipo</label>
                            <select id="transactionType" name="transactionType" class="form__select" required>
                                <option value="income">Ingreso</option>
                                <option value="expense">Gasto</option>
                            </select>
                        </div>
                        <div class="form__group">
                            <label for="transactionDate" class="form__label">Fecha</label>
                            <input type="date" id="transactionDate" name="transactionDate" class="form__input" required>
                        </div>
                        <div class="form__group">
                            <label for="amount" class="form__label">Monto ($)</label>
                            <input type="number" id="amount" name="amount" step="0.01" class="form__input" required maxlength="15">
                        </div>
                        <div class="form__group">
                            <label for="reason" class="form__label">Motivo</label>
                            <div class="form__group--horizontal">
                                <select id="reason" name="reason" class="form__select" required>
                                    <option value="">Seleccionar motivo</option>
                                </select>
                                <button type="button" id="newReasonBtn" class="btn btn--secondary btn--small">
                                    <i class="fas fa-plus"></i> Nuevo
                                </button>
                            </div>
                            <div id="newReasonForm" class="form__group--nested form__group--nested-vertical" hidden>
                                <div class="form__group--nested-inputs">
                                    <input type="text" id="newReasonInput" class="form__input" placeholder="Nombre del nuevo motivo" maxlength="50">
                                </div>
                                <div class="form__group--nested-actions">
                                    <button type="button" id="cancelReasonBtn" class="btn btn--secondary btn--small">Cancelar</button>
                                    <button type="button" id="saveReasonBtn" class="btn btn--primary btn--small">Guardar</button>
                                </div>
                            </div>
                        </div>
                        <div class="form__group">
                            <label for="bankAccount" class="form__label">Cuenta bancaria (opcional)</label>
                            <div class="form__group--horizontal">
                                <select id="bankAccount" name="bankAccount" class="form__select">
                                    <option value="">Seleccionar cuenta</option>
                                </select>
                                <button type="button" id="newBankAccountBtn" class="btn btn--secondary btn--small">
                                    <i class="fas fa-plus"></i> Nuevo
                                </button>
                            </div>
                            <div id="newBankAccountForm" class="form__group--nested form__group--nested-vertical" hidden>
                                <div class="form__group--nested-inputs">
                                    <input type="text" id="newAccountNameInput" class="form__input" placeholder="Nombre de la cuenta" maxlength="50">
                                    <select id="financialEntitySelect" class="form__select">
                                        <option value="">Seleccionar entidad</option>
                                    </select>
                                </div>
                                <div class="form__group--nested-actions">
                                    <button type="button" id="cancelBankAccountBtn" class="btn btn--secondary btn--small">Cancelar</button>
                                    <button type="button" id="saveBankAccountBtn" class="btn btn--primary btn--small">Guardar</button>
                                </div>
                            </div>
                        </div>
                        <div class="form__group">
                            <label for="recipient" class="form__label">Contacto emisor/destinatario (opcional)</label>
                            <div class="form__group--horizontal">
                                <select id="recipient" name="recipient" class="form__select">
                                    <option value="">Seleccionar contacto</option>
                                </select>
                                <button type="button" id="newContactBtn" class="btn btn--secondary btn--small">
                                    <i class="fas fa-plus"></i> Nuevo
                                </button>
                            </div>
                            <div id="newContactForm" class="form__group--nested form__group--nested-vertical" hidden>
                                <div class="form__group--nested-inputs">
                                    <input type="text" id="newContactInput" placeholder="Ingrese el nuevo contacto" class="form__input" maxlength="50">
                                </div>
                                <div class="form__group--nested-actions">
                                    <button type="button" id="cancelContactBtn" class="btn btn--secondary btn--small">Cancelar</button>
                                    <button type="button" id="saveContactBtn" class="btn btn--primary btn--small">Guardar</button>
                                </div>
                            </div>
                        </div>
                        <div class="form__group">
                            <label for="description" class="form__label">Descripción (opcional)</label>
                            <textarea id="description" name="description" rows="3" class="form__textarea" maxlength="100"></textarea>
                        </div>
                        <div class="form__actions">
                            <button type="button" id="cancelTransactionBtn" class="btn btn--secondary">Cancelar</button>
                            <button type="submit" class="btn btn--primary">Guardar</button>
                        </div>
                    </form>
                </div>

                <!-- Contenido de Movimiento entre cuentas -->
                <div id="tab-transferencia" class="tab-content">
                    <form id="transferForm" class="form">
                        <p class="form__subtitle">Anotar que realizaste un movimiento de dinero entre dos cuentas bancarias registradas en el sistema.</p>
                        <div class="form__group">
                            <label for="transferSourceAccount" class="form__label">Cuenta de origen</label>
                            <select id="transferSourceAccount" name="transferSourceAccount" class="form__select" required>
                                <option value="">Seleccionar cuenta de origen</option>
                            </select>
                        </div>
                        <div class="form__group">
                            <label for="transferDestinationAccount" class="form__label">Cuenta de destino</label>
                            <select id="transferDestinationAccount" name="transferDestinationAccount" class="form__select" required>
                                <option value="">Seleccionar cuenta de destino</option>
                            </select>
                        </div>
                        <div class="form__group">
                            <label for="transferAmount" class="form__label">Monto ($)</label>
                            <input type="number" id="transferAmount" name="transferAmount" step="0.01" class="form__input" required maxlength="15">
                        </div>
                        <div class="form__actions">
                            <button type="button" id="cancelTransferBtn" class="btn btn--secondary">Cancelar</button>
                            <button type="submit" class="btn btn--primary">Realizar movimiento</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Ver Movimientos -->
    <div id="searchModal" class="modal" hidden>
        <div class="modal__content">
            <div class="modal__header">
                <h2 class="modal__title">Ver movimientos</h2>
                <button id="closeSearchModalBtn" class="modal__close-btn" aria-label="Cerrar modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal__body">
                <form id="searchForm" class="form">
                    <p class="form__subtitle">Buscar movimientos de dinero registrados anteriormente. Todos los campos de búsqueda son opcionales. Excepción: si ingresas un "mes" debes especificar su "año".</p>
                    <div class="form__group--grid">
                        <div class="form__group">
                            <label for="searchMonth" class="form__label">Mes</label>
                            <select id="searchMonth" name="searchMonth" class="form__select">
                                <option value="">Todos</option>
                                <option value="1">Enero</option>
                                <option value="2">Febrero</option>
                                <option value="3">Marzo</option>
                                <option value="4">Abril</option>
                                <option value="5">Mayo</option>
                                <option value="6">Junio</option>
                                <option value="7">Julio</option>
                                <option value="8">Agosto</option>
                                <option value="9">Septiembre</option>
                                <option value="10">Octubre</option>
                                <option value="11">Noviembre</option>
                                <option value="12">Diciembre</option>
                            </select>
                        </div>
                        <div class="form__group">
                            <label for="searchYear" class="form__label">Año</label>
                            <input type="text" id="searchYear" name="searchYear" class="form__input">
                        </div>
                        <div class="form__group">
                            <label for="searchReason" class="form__label">Motivo</label>
                            <select id="searchReason" name="searchReason" class="form__select">
                                <option value="">Seleccionar motivo</option>
                            </select>
                        </div>
                        <div class="form__group">
                            <label for="searchRecipient" class="form__label">Contacto</label>
                            <select id="searchRecipient" name="searchRecipient" class="form__select">
                                <option value="">Seleccionar contacto</option>
                            </select>
                        </div>
                        <div class="form__group">
                            <label for="orderBy" class="form__label">Ordenar por</label>
                            <select id="orderBy" name="orderBy" class="form__select">
                                <option value="date-desc">Fecha (más recientes)</option>
                                <option value="date-asc">Fecha (más antiguos)</option>
                                <option value="amount-desc">Monto (mayor a menor)</option>
                                <option value="amount-asc">Monto (menor a mayor)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form__actions">
                        <button type="button" id="clearSearchBtn" class="btn btn--secondary">Limpiar</button>
                        <button type="submit" class="btn btn--primary">
                            <i class="fas fa-search"></i> Buscar
                        </button>
                    </div>
                </form>
                <div id="searchResults" class="search-results">
                    <!-- Los resultados de la búsqueda se mostrarán aquí -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Configurar Alerta de Presupuesto -->
    <div id="budgetModal" class="modal" hidden>
        <div class="modal__content">
            <div class="modal__header">
                <h2 class="modal__title">Configurar alertas de presupuesto</h2>
                <button id="closeBudgetModalBtn" class="modal__close-btn" aria-label="Cerrar modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal__body">
                <form id="budgetForm" class="form">
                    <p class="form__subtitle">Crear una alerta definiendo un motivo y un límite umbral. Cuando el gasto en este motivo supere el umbral será notificado.</p>
                    <div class="form__group">
                        <label for="budgetReason" class="form__label">Motivo</label>
                        <select id="budgetReason" name="budgetReason" class="form__select" required>
                            <option value="">Seleccionar motivo</option>
                        </select>
                    </div>
                    <div class="form__group">
                        <label for="budgetThreshold" class="form__label">Monto de alerta ($)</label>
                        <input type="number" id="budgetThreshold" name="budgetThreshold" step="0.01" class="form__input" required>
                    </div>
                    <div class="form__actions">
                        <button type="button" id="cancelBudgetBtn" class="btn btn--secondary">Cancelar</button>
                        <button type="submit" class="btn btn--primary">Guardar alerta</button>
                    </div>
                </form>
                <div class="alerts-list-container">
                    <h3 class="alerts-list__title">Alertas configuradas</h3>
                    <div id="alertsList" class="alerts-list">
                        <!-- Las alertas se cargarán aquí -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Administración de Espacios de Trabajo -->
    <div id="manageWorkspacesModal" class="modal" hidden>
        <div class="modal__content">
            <div class="modal__header">
                <h2 class="modal__title">Administración de espacios de trabajo</h2>
                <button id="closeManageWorkspacesModalBtn" class="modal__close-btn" aria-label="Cerrar modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal__body">
                <div class="tabs">
                    <button class="tabs__button tabs__button--active" data-tab="new-workspace">Nuevo espacio</button>
                    <button class="tabs__button" data-tab="share-workspace">Compartir espacio</button>
                </div>

                <!-- Contenido de Nuevo Espacio -->
                <div id="tab-new-workspace" class="tab-content tab-content--active">
                    <form id="workspaceForm" class="form">
                        <p class="form__subtitle">Crear un nuevo espacio de trabajo donde puedes registrar todos tus movimientos de dinero y realizar diferentes análisis de datos.</p>
                        <div class="form__group">
                            <label for="workspaceName" class="form__label">Nombre del espacio</label>
                            <div class="form__input-container">
                                <input type="text" id="workspaceName" name="workspaceName" class="form__input" placeholder="Ej: Campo nuevo" required maxlength="50">
                                <span id="workspaceNameError" class="form__error-message" hidden>*</span>
                            </div>
                        </div>
                        <div class="form__actions">
                            <button type="button" id="cancelWorkspaceBtn" class="btn btn--secondary">Cancelar</button>
                            <button type="submit" class="btn btn--primary">Guardar espacio</button>
                        </div>
                    </form>
                </div>

                <!-- Contenido de Compartir Espacio -->
                <div id="tab-share-workspace" class="tab-content">
                    <form id="shareForm" class="form">
                        <p class="form__subtitle">Comparte un espacio de trabajo con otra persona para que pueda ver, anotar movimientos de dinero y realizar diferentes análisis de datos.</p>
                        <div class="form__group">
                            <label for="shareWorkspaceSelect" class="form__label">Espacio de trabajo</label>
                            <select id="shareWorkspaceSelect" name="shareWorkspaceSelect" class="form__select" required>
                                <!-- Opciones de espacios de trabajo se llenarán dinámicamente -->
                            </select>
                        </div>
                        <div class="form__group">
                            <label for="shareEmail" class="form__label">Email del invitado</label>
                            <input type="email" id="shareEmail" name="shareEmail" class="form__input" placeholder="invitado@example.com" required maxlength="100">
                        </div>
                        <div class="form__actions">
                            <button type="button" id="cancelShareBtn" class="btn btn--secondary">Cancelar</button>
                            <button type="submit" class="btn btn--primary">Enviar invitación</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Contenedor para Notificaciones -->
    <div id="notification-container" class="notification-container"></div>

    <!-- Modal: Detalle del movimiento -->
    <div id="transactionDetailModal" class="modal" hidden>
        <div class="modal__content">
            <div class="modal__header">
                <h2 class="modal__title">Detalle del movimiento</h2>
                <button id="closeTransactionDetailModalBtn" class="modal__close-btn" aria-label="Cerrar modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal__body">
                <div id="transactionDetailContent" class="transaction-detail">
                    <!-- El contenido se llenará dinámicamente -->
                </div>
                <div class="form__actions">
                    <button type="button" id="removeTransactionBtn" class="btn btn--danger">Remover</button>
                    <button type="button" id="backTransactionDetailBtn" class="btn btn--secondary">Volver</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
